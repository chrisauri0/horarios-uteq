<div class="notice" role="alert" aria-live="polite">
    <svg class="notice-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
    <div class="notice-content">
        <h3>Aviso importante: est치s a punto de crear los horarios para {{ usuarioCarrera }}</h3>
        <p>Se est치n tomando en cuenta los salones creados para {{ usuarioCarrera }} en el cuatrimestre 7.</p>
        <p>Este proceso tomar치 unos cuantos segundos. Por favor, no cierres la ventana ni navegues fuera de esta
            p치gina mientras se generan los horarios.</p>
    </div>
</div>


<div class="scheduler-container">
    <h2>Generador de Horarios</h2>



    <button (click)="generateSchedule()" [disabled]="loading" class="generate-btn">
        {{ loading ? 'Generando...' : 'Generar Horarios' }}
    </button>

    <div [hidden]="!message" class="message" [ngClass]="{ success: isSuccess, error: !isSuccess }">
        {{ message }}
    </div>

    <div [hidden]="!loading" class="spinner"></div>
</div>

<div>
    <div>
        <h1>Horarios creados:</h1>
        <div class="view-toggle prettier-toggle">
            <button type="button" class="toggle-btn" [class.active]="vistaHorarios === 'grupo'"
                (click)="vistaHorarios = 'grupo'">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" viewBox="0 0 24 24">
                    <path d="M3 7h18M3 12h18M3 17h18" />
                </svg>
                <span>Ver por grupos</span>
            </button>
            <button type="button" class="toggle-btn" [class.active]="vistaHorarios === 'profesor'"
                (click)="vistaHorarios = 'profesor'">
                <img src="/assets/svgs/graduation-hat-alt-svgrepo-com.svg" alt="Profesores" class="icon" />
                <span>Ver por profesores</span>
            </button>
        </div>
        <div *ngIf="vistaHorarios === 'grupo' && groupedSchedules.length">
            <h3>Horarios por grupo</h3>
            <div class="schedules-list">


                <div *ngFor="let group of groupedSchedules" class="schedule-group">
                    <h4 class="group-title">{{ group.nombregrupo }} <span class="count">({{ group.data.length }})</span>
                    </h4>
                    <button class="export-btn" (click)="exportarPDF(group)">
                        <svg class="export-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 16v-8" />
                            <path d="M8 12l4 4 4-4" />
                            <rect x="4" y="20" width="16" height="2" rx="1" />
                            <rect x="4" y="4" width="16" height="2" rx="1" />
                        </svg>
                        <span>Exportar a PDF</span>
                    </button>
                    <table class="horario-table">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th *ngFor="let dia of diasSemana">{{ dia }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let hora of horas">
                                <td class="hora-label">{{ hora }}:00</td>
                                <td *ngFor="let dia of diasSemana">
                                    <ng-container *ngIf="getClase(group.data, dia, hora) as clase">
                                        <div *ngIf="clase">
                                            <div class="materia">{{ clase.subj }}</div>
                                            <div class="profesor">{{ clase.prof }}</div>
                                            <div class="salon">{{ clase.room }}</div>
                                        </div>
                                    </ng-container>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div *ngIf="vistaHorarios === 'profesor' && groupedSchedules.length">
            <h3>Horarios por profesor</h3>
            <div class="schedules-list">
                <div *ngFor="let prof of profesoresConHorarios" class="schedule-group">
                    <h4 class="group-title">{{ prof.nombre }} <span class="count">({{ prof.clases.length }})</span></h4>
                    <button class="export-btn" (click)="exportarPDFProfesor(prof)">
                        <svg class="export-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 16v-8" />
                            <path d="M8 12l4 4 4-4" />
                            <rect x="4" y="20" width="16" height="2" rx="1" />
                            <rect x="4" y="4" width="16" height="2" rx="1" />
                        </svg>
                        <span>Exportar a PDF</span>
                    </button>
                    <table class="horario-table">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th *ngFor="let dia of diasSemana">{{ dia }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let hora of horas">
                                <td class="hora-label">{{ hora }}:00</td>
                                <td *ngFor="let dia of diasSemana">
                                    <ng-container *ngIf="getClaseProfesor(prof.clases, dia, hora) as clase">
                                        <div *ngIf="clase">
                                            <div class="materia">{{ clase.subj }}</div>
                                            <div class="grupo">Grupo: {{ clase.group || clase.grupo || '-' }}</div>
                                            <div class="salon">{{ clase.room }}</div>
                                        </div>
                                    </ng-container>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>