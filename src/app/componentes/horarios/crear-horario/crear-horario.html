<div class="container" [formGroup]="horarioForm">
    <h2>{{ horarioForm.get('nombre')?.value }}</h2>
    <p><strong>Ciclo:</strong> {{ horarioForm.get('ciclo')?.value }}</p>

    <div formArrayName="dias">
        <div *ngFor="let diaGroup of diasArray.controls; let i = index" [formGroupName]="i" class="dia-card">
            <h3> Día {{ i + 1 }} — {{ diaGroup.get('dia')?.value }}</h3>

            <!-- selector de día (Lun..Dom) -->
            <label>Día:</label>
            <select formControlName="dia">
                <option *ngFor="let d of ['Lun','Mar','Mie','Jue','Vie','Sab','Dom']" [value]="d">{{ d }}</option>
            </select>

            <!-- ---------- Lista de clases (FormArray dentro de cada día) ---------- -->
            <div formArrayName="clases" class="clases-list">
                <div *ngFor="let claseCtrl of getClasesArrayAt(i).controls; let j = index" [formGroupName]="j"
                    class="clase-card">
                    <h4>Clase {{ j + 1 }}</h4>

                    <div class="row">
                        <label>Inicio:</label>
                        <input type="time" formControlName="horaInicio" />
                        <label>Fin:</label>
                        <input type="time" formControlName="horaFin" />
                    </div>

                    <div class="row">
                        <label>Profesor:</label>
                        <input type="text" formControlName="profesorNombre" />
                    </div>

                    <div class="row">
                        <label>Materia:</label>
                        <input type="text" formControlName="materiaNombre" />
                    </div>

                    <div class="row">
                        <label>Salón:</label>
                        <input type="text" formControlName="salonNombre" />
                    </div>

                    <button type="button" (click)="removeClaseFromDia(i, j)">Eliminar clase</button>
                    <hr />
                </div>
            </div>

            <!-- botones para manejar clases del día -->
            <button type="button" (click)="addClaseToDia(i)">Agregar clase a este día</button>
            <button type="button" (click)="removeDia(i)">Eliminar día</button>

            <!-- mostrar conflictos simples por día -->
            <div *ngIf="findConflictsInDia(i).length > 0" class="warning">
                ⚠️ Conflictos en las clases: índices {{ findConflictsInDia(i).join(', ') }}
            </div>
        </div>
    </div>

    <!-- botones globales -->
    <div class="actions">
        <button type="button" (click)="addDia()">Agregar día</button>
        <button type="button" (click)="verConsola()">Ver horario en consola</button>
    </div>
</div>